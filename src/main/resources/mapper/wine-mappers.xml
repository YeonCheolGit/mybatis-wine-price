<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.wine">
    <resultMap id="wineResult" type="main.DTO.WineDTO">
        <result property="number" column="number" />
        <result property="name" column="name" />
        <result property="food" column="food" />
        <result property="price" column="price" />
    </resultMap>

    <select id="selectAllWines" resultMap="wineResult">
        <![CDATA[
        select *
        from MVC.wine
        order by number;
        ]]>
    </select>

    <insert id="addWineNamePrice" parameterType="String">
        <![CDATA[
        insert into MVC.wine (name, price)
        values (#{name}, #{price})
        on duplicate key update name = #{name};
        ]]>
    </insert>

    <select id="readOneWine" resultMap="wineResult" parameterType="int">
        <![CDATA[
        select *
        from MVC.wine
        where number = #{number};
        ]]>
    </select>

    <select id="listPaging" resultMap="wineResult">
        <![CDATA[
        select *
        from MVC.wine
        where number > 0
        ]]>
        <include refid="search"/>
        <![CDATA[
        order by number
        limit #{pageStart}, #{perPageNum}
        ]]>
    </select>

    <select id="countWines" resultType="int">
        <![CDATA[
        select COUNT(number)
        from MVC.wine
        where number > 0
        ]]>
        <include refid="search" />
    </select>

    <sql id="search">
        <if test="searchType != null">
            <if test="searchType == 't'.toString()">
                and name like concat('%', #{keyword}, '%')
            </if>
            <if test="searchType == 'c'.toString()">
                and price like concat('%', #{keyword}, '%')
            </if>
            <if test="searchType == 'w'.toString()">
                and food like concat('%', #{keyword}, '%')
            </if>
        </if>
    </sql>

    <select id="search" resultType="String" parameterType="String">
        select name
        from MVC.wine
        where name like concat('%', #{keyword}, '%')
        order by name
    </select>

</mapper>